---
title: "Safely transferring large amounts of data using rsync"
sub_title: "A quick how-to on remote data tranfers for bioinformaticians"
categories:
  - Bioinformatics
elements:
  - file
  - data management
  - rsync
  - screen
  - find
---
 
A procedure that I've done practically every day since starting graduate school was to transfer large files and directories between computers. Often, it's not as simple as running the exact same command each time, and there are slight modifications needed to make sure I transfer only what I want to. But the fundamentals are very simple, and are the same for 95% of what I need to do. Here, I'll explain how to use `screen`, `rsync` and other file searching methods to make sure that files and directories get transferred reliably and efficiently.

<br>


## Dependancies

If you're primarly working on a MacOS or Linux machine, the `screen` and `rsync` utilities are most likely already  installed. On the off chance they aren't, they can be easily installed:

```shell
sudo apt update

sudo apt install screen rsync
```

<br>

## Setting up a screen session

`screen` is a utility that lets you run multiple independant commands from a single terminal session. These commands will continue to run as long as the screen is active. Say you're running running a command in a screen set up on a remote computer from your laptop at home. You could throw your laptop out the window, and the command will still run remotely with no issues.

We want to set up large jobs, such as file transfers, inside a `screen` session because it might take hours or days. We don't want any interruptions to occur, because that can cause file corruption that becomes annoying to deal with. Setting up and managing screens is relatively easy, and only requires a few commands to remember:

#### 1. Listing active screens
```shell
screen -ls # this will list any active screens, and whether you are attached or detached to those screens
```

#### 2. Creating a screen session (this will automatically enter the screen session)
```shell
screen -S name_of_screen
```

#### 3. Detaching from a screen
<kbd>Control + A + D</kbd>

#### 4. Reattaching to a screen
```shell
screen -r name_of_screen
```

Memorize these commands, which will quickly become 2<sup>nd</sup> nature, and you're good to go. You should first set up a screen, and then run `rsync` from inside that screen (read below).

<br>

## rsync basics

[rsync](https://linux.die.net/man/1/rsync) is a great file transfer program for transferring large amounts of data efficiently. I almost always only use the same 5 options, detailed below. 

| Option | Definition | 
|:--------|:-------:|
| -P  | keeps partially transferred files and shows a progress bar   | 
| -a    | archive, preserves many important attributes of the files   |
| -v   | verbose, outputs more details on the transfer   | 
| -z   | compresses files during transfer   | 
| -h   | makes outputs like filesizes human readable   | 
|====================

Occasionally, I will also use `-r` or `-n`:

| Option | Definition | 
|:--------|:-------:|
| -r  | recurse into directories, if you're copying directories   | 
| -n    | dry run, if you want to see what will happen without running the transfer   |
|====================

<br>
The very basic syntax for a remote transfer of a file or files is as follows:

```shell
# File(s) transfer
rsync -Pavzh /source_dir/ remote_username@remote_domain_or_IP:/dest_dir/
```
<br>
## Selective file transfer with `find` and wildcard expansion

Selectively copying files is immensely useful and will save you a lot of time. Below, I'll outline some of the common use cases I encounter:

<br>
#### Transfer only certain file extensions which exist in multiple directories
```shell
# The additional --no-relative and --no-dirs options effectively flattens the directory structure, putting all files into a single parent directory
# This command finds all "fastq.gz" files in multiple directories and moves them

rsync -Pavzh `find /source_dir_1/ /source_dir_2/ -type f -name "*.fastq.gz"\` --no-relative --no-dirs remote_username@remote_domain_or_IP:/dest_dir/
```

#### Transfer only some files from a single directory, using pattern matching
```shell
# Use wildcard expansion to specify filenames. This will find files that match the pattern and transfer only those

rsync -Pavzh {Sample1*,Sample2*,Sample3*} remote_username@remote_domain_or_IP:/dest_dir/
```